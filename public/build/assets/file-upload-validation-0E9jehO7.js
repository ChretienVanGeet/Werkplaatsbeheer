class l{constructor(i={}){this.serverLimits=i.serverLimits||{},this.translations=i.translations||{},this.selector=i.selector||".file-upload-validation",this.allowedTypes=i.allowedTypes||this.getDefaultAllowedTypes(),this.initializeLimits(),this.initializeEventListeners()}translate(i,e={}){let t=this.translations[i]||i;return Object.keys(e).forEach(a=>{t=t.replace(`:${a}`,e[a])}),t}initializeLimits(){this.LARAVEL_MAX_FILE_SIZE=5242880,this.SERVER_MAX_FILE_SIZE=this.serverLimits.upload_max_filesize||this.LARAVEL_MAX_FILE_SIZE,this.MAX_FILE_SIZE=Math.min(this.LARAVEL_MAX_FILE_SIZE,this.SERVER_MAX_FILE_SIZE),this.MAX_TOTAL_SIZE=this.serverLimits.recommended_total_size||8388608,this.MAX_FILE_SIZE_MB=Math.round(this.MAX_FILE_SIZE/1024/1024),this.LARAVEL_MAX_FILE_SIZE_MB=Math.round(this.LARAVEL_MAX_FILE_SIZE/1024/1024)}getDefaultAllowedTypes(){return["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","image/jpeg","image/jpg","image/png","image/gif","application/zip","application/x-rar-compressed"]}debugLimits(){console.log("File Upload Validation Debug:",{"Laravel Max (5MB)":this.LARAVEL_MAX_FILE_SIZE,"Server upload_max_filesize":this.SERVER_MAX_FILE_SIZE,"Effective MAX_FILE_SIZE":this.MAX_FILE_SIZE,MAX_FILE_SIZE_MB:this.MAX_FILE_SIZE_MB,serverLimits:this.serverLimits,selector:this.selector})}validateFileSelection(i){const e=Array.from(i.target.files),t=[];let a=0;if(e.length===0)return!0;if(e.forEach(s=>{if(s.size>this.MAX_FILE_SIZE){const o=Math.round(s.size/1024/1024*100)/100,r=this.MAX_FILE_SIZE_MB,n=this.translate("File exceeds :limitMB limit",{limitMB:r});t.push(`${s.name}: ${n} (${o}MB)`)}if(!this.allowedTypes.includes(s.type)){const o=this.translate("File type not allowed");t.push(`${s.name}: ${o} (${s.type})`)}a+=s.size}),a>this.MAX_TOTAL_SIZE){const s=Math.round(a/1024/1024*100)/100,o=this.translate("Total file size exceeds server limit. Please upload fewer or smaller files.");t.push(`${o} (${s}MB)`)}return t.length>0?(this.showErrors(t),i.target.value="",!1):!0}showErrors(i){if(window.Flux&&window.Flux.toast)window.Flux.toast(i.join(`
`),{variant:"danger"});else{const e=this.translate("File Upload Errors");alert(`${e}:

${i.join(`
`)}`)}}initializeEventListeners(){document.addEventListener("change",e=>{e.target.type==="file"&&e.target.closest(this.selector)&&e.target.hasAttribute("wire:model")&&this.validateFileSelection(e)},!0),document.addEventListener("livewire:request",()=>{window.fileUploadInProgress=!0}),document.addEventListener("livewire:response",()=>{window.fileUploadInProgress=!1});const i=e=>{var a;const t=(a=e.detail)==null?void 0:a.response;if(t&&t.status===413){if(window.Flux&&window.Flux.toast){const s=this.translate("Upload failed: Files are too large for server limits. Please upload smaller files or contact your administrator.");window.Flux.toast(s,{variant:"danger"})}e.preventDefault()}else if(t&&t.status>=400&&t.status<500){if(window.Flux&&window.Flux.toast){const s=this.translate("Upload failed: Please check your files and try again.");window.Flux.toast(s,{variant:"danger"})}e.preventDefault()}};document.addEventListener("livewire:error",i)}static initializeFromGlobal(i="fileUploadValidationConfig",e=".file-upload-validation"){const t=window[i]||{};return t.selector=e,new l(t)}}window.FileUploadValidation=l;document.addEventListener("DOMContentLoaded",function(){window.fileUploadValidationConfig&&l.initializeFromGlobal()});
